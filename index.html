<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Økonomi Pie Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .container { max-width: 900px; margin: 40px auto; padding: 20px; }
    table { margin-top: 30px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>

<div class="container">
  <h2>Din økonomifordeling</h2>

  <canvas id="myChart" height="320"></canvas>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Kategori</th>
        <th>Beløp (kr)</th>
      </tr>
    </thead>
    <tbody>
      <!-- rader fylles dynamisk -->
    </tbody>
  </table>

  <button onclick="updateChart()">Oppdater diagram</button>
</div>

<script>
  const ctx = document.getElementById('myChart').getContext('2d');
  let chart;

  function updateChart() {
    const inputs = document.querySelectorAll('.category-input');
    const values = document.querySelectorAll('.value-input');

    const labels = [];
    const data = [];

    inputs.forEach((inp, i) => {
      const cat = inp.value.trim();
      const val = parseFloat(values[i].value) || 0;
      if (cat && val > 0) {
        labels.push(cat);
        data.push(val);
      }
    });

    // Oppdater tabell
    const tbody = document.querySelector('#dataTable tbody');
    tbody.innerHTML = '';
    labels.forEach((cat, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${cat}</td><td>${data[i].toLocaleString('nb-NO')} kr</td>`;
      tbody.appendChild(tr);
    });

    // Oppdater / opprett chart
    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: data,
          backgroundColor: [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
            '#9966FF', '#FF9F40', '#E7E9ED', '#C9CBCF'
          ],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                let sum = ctx.dataset.data.reduce((a,b)=>a+b,0);
                let prosent = ((ctx.parsed / sum) * 100).toFixed(1);
                return `${ctx.label}: ${ctx.parsed.toLocaleString('nb-NO')} kr (${prosent}%)`;
              }
            }
          }
        }
      }
    });
  }

  // Legg til 6 tomme rader som standard
  window.onload = () => {
    const tbody = document.querySelector('#dataTable tbody');
    for (let i = 0; i < 8; i++) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="category-input" placeholder="Kategori ${i+1}"></td>
        <td><input type="number" class="value-input" placeholder="0" min="0"></td>
      `;
      tbody.appendChild(tr);
    }
    updateChart(); // initial visning
  };
</script>
</body>
</html>
